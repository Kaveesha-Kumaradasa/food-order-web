<div class="cart-container" *ngIf="(items$ | async) as items; else emptyCart">
  <h2>Your Cart</h2>

  <div class="cart-items" *ngIf="items.length > 0; else emptyCart">
    <div class="cart-item" *ngFor="let item of items; trackBy: trackById">
      <div class="left">
        <img [src]="item.image || fallbackImage"
             (error)="onImageError($event)"
             alt="{{ item.name }}" />
        <div class="meta">
          <div class="name">{{ item.name }}</div>
          <div class="price">LKR {{ item.price | number:'1.2-2' }}</div>
        </div>
      </div>

      <div class="right">
        <div class="qty">
          <button (click)="decrease(item.id)" aria-label="Decrease">âˆ’</button>
          <input type="number" [value]="item.qty" (change)="updateQty(item.id, $any($event.target).value)" min="1" />
          <button (click)="increase(item.id)" aria-label="Increase">+</button>
        </div>

        <div class="line-total">LKR {{ item.lineTotal | number:'1.2-2' }}</div>

        <button class="remove" (click)="remove(item.id)">Remove</button>
      </div>
    </div>
  </div>

  <div class="cart-summary" *ngIf="items.length > 0">
    <div class="row">
      <span>Items</span>
      <strong>{{ (count$ | async) || 0 }}</strong>
    </div>
    <div class="row total">
      <span>Total</span>
      <strong>LKR {{ (total$ | async) || 0 | number:'1.2-2' }}</strong>
    </div>

    <div class="actions">
      <button class="clear" (click)="clear()">Clear Cart</button>

    </div>
  </div>
</div>

<ng-template #emptyCart>
  <div class="cart-container">
    <p>Your cart is empty!</p>
  </div>
</ng-template>
